<!DOCTYPE html>
<html>

  <head>
    <meta charset=”UTF-8”>
    <title>Using the Rickshaw Library to     create graphs</title>
        <link type=”text/css” rel=”stylesheet”     href=”styles/rickshaw.min.css” />
        <link type=”text/css” rel=”stylesheet”     href=”styles/screen.css” />    
        <script src=”scripts/d3.min.js”></script>
        <script src=”scripts/d3.layout.min.js”></script>
        <script src=”scripts/rickshaw.min.js”></    script>

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">Battery Voltage<sup>2</sup></h1>
h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner" style="height: 480px">
      <div id="chart_container" >
          <div id="chart"></div>
          <div id="legend_container">
            <div id="smoother" title="Smoothing"></div>
            <div id="legend"></div>
          </div>
          <div id="slider"></div>
      </div>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Xively-rickshaw maintained by <a href="https://github.com/jasonneylon">jasonneylon</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

<script>

// Set your API key first  
xively.setKey( "AkDCUKiOhUnUZWDKBhQ7DYuf0MHlmmzK9QCGfenFw0WCFC7B" );  

var startOfYesterday = moment().subtract("day", 1).startOf('day');
var endOfYesterday = moment().startOf('day');

console.log(startOfYesterday);
console.log(endOfYesterday);

var query = { 
  start: startOfYesterday.toJSON(), 
  end: endOfYesterday.toJSON(), 
  interval: 60, 
  limit: 1000 
};

xively.datastream.history( "396478290", "Scale1", query, loadData);  

function loadData(data) {  
  var unit = data.unit.label;
  var series = [];
  var filtedData = data.datapoints.filter(function(x) { return (x.value < 100000); });
  for (var i=0; i < filtedData.length; i++ ) {
    var date = moment(filtedData[i].at);
    var value = parseFloat(filtedData[i].value);
    series[i] = {x: date.unix(), y: value};
  }
  drawGraph(series, unit);
}

function drawGraph(data, unit) {
  var graph = new Rickshaw.Graph( {
    element: document.querySelector("#chart"),
    width: 400,
    height: 400,
    renderer: 'line',
    /*
    min: 45,
    max: 55,
    /*
		min: parseFloat(datastream.min_value) - .25*(parseFloat(datastream.max_value) - parseFloat(datastream.min_value)),
		max: parseFloat(datastream.max_value) + .25*(parseFloat(datastream.max_value) - parseFloat(datastream.min_value)),
		*/
    series: [
      {
        data: data,
        color: '#6060c0',
        name: unit
      }
    ]
  } );
  graph.render();

  var hoverDetail = new Rickshaw.Graph.HoverDetail( {
    graph: graph
  } );

  var legend = new Rickshaw.Graph.Legend( {
    graph: graph,
    element: document.getElementById('legend')
  } );

  var shelving = new Rickshaw.Graph.Behavior.Series.Toggle( {
    graph: graph,
    legend: legend
  } );


  var axes = new Rickshaw.Graph.Axis.Time( {
    graph: graph
  });
  axes.render();
  
  var yAxis = new Rickshaw.Graph.Axis.Y({
      graph: graph
  });

  yAxis.render();
}
</script>


</body>
</body>
